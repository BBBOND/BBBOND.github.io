{"title":"Android混淆笔记(修改中)","slug":"Android-ProGuard-Note","date":"2017-07-29T05:08:00.000Z","updated":"2020-02-09T15:22:37.131Z","comments":true,"path":"api/articles/Android-ProGuard-Note.json","excerpt":"混淆是常用的减小app大小，增加app安全性的方法。","covers":null,"content":"<p>混淆是常用的减小app大小，增加app安全性的方法。</p>\n<a id=\"more\"></a>\n<h2 id=\"作用\"><a class=\"header-anchor\" href=\"#作用\"></a>作用</h2>\n<blockquote>\n<p>          代码混淆由ProGuard提供支持，ProGuard会检测和移除封装应用中未使用的类、字段、方法和属性，包括自带代码库中的未使用项（这使其成为以变通方式解决64k引用限制的有用工具）。ProGuard还可优化字节码，移除未使用的代码指令，以及用短名称混淆其余的类、字段和方法。混淆过的代码可令您的APK难以被逆向工程，这在应用使用许可验证等安全敏感性功能时特别有用。</p>\n</blockquote>\n<p>以上为Android官网<a href=\"https://developer.android.com/studio/build/shrink-code.html\" target=\"_blank\" rel=\"noopener\">原文</a>描述，其主要作用主要有那么几点：</p>\n<ul>\n<li>减少方法数</li>\n<li>增加反编译的难度</li>\n<li>app瘦身</li>\n</ul>\n<h2 id=\"一言不合上实例\"><a class=\"header-anchor\" href=\"#一言不合上实例\"></a>一言不合上实例</h2>\n<p>以下为收集整理的混淆配置，复制到项目就可使用</p>\n<ul>\n<li>\n<p>通用配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#开启即可关闭混淆</span></span><br><span class=\"line\"><span class=\"comment\">#-dontobfuscate</span></span><br><span class=\"line\"><span class=\"comment\">#---------------Begin: proguard configuration common for all Android apps ----------#</span></span><br><span class=\"line\"><span class=\"comment\">#指定代码的压缩级别</span></span><br><span class=\"line\">-optimizationpasses 5</span><br><span class=\"line\"><span class=\"comment\">#包名不混合大小写</span></span><br><span class=\"line\">-dontusemixedcaseclassnames</span><br><span class=\"line\"><span class=\"comment\">#不去忽略非公共的库类</span></span><br><span class=\"line\">-dontskipnonpubliclibraryclasses</span><br><span class=\"line\">-dontskipnonpubliclibraryclassmembers</span><br><span class=\"line\"><span class=\"comment\">#优化  不优化输入的类文件</span></span><br><span class=\"line\">-dontoptimize</span><br><span class=\"line\"><span class=\"comment\">#预校验</span></span><br><span class=\"line\">-dontpreverify</span><br><span class=\"line\"><span class=\"comment\">#混淆时是否记录日志</span></span><br><span class=\"line\">-verbose</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 混淆时所采用的算法</span></span><br><span class=\"line\">-optimizations !code/simplification/arithmetic,!field/*,!class/merging/*</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#-------------start：记录生成的日志数据,gradle build时在本项目根目录输出-------------#</span></span><br><span class=\"line\"><span class=\"comment\">#apk 包内所有 class 的内部结构</span></span><br><span class=\"line\">-dump proguard/class_files.txt</span><br><span class=\"line\"><span class=\"comment\">#未混淆的类和成员</span></span><br><span class=\"line\">-printseeds proguard/seeds.txt</span><br><span class=\"line\"><span class=\"comment\">#列出从 apk 中删除的代码</span></span><br><span class=\"line\">-printusage proguard/unused.txt</span><br><span class=\"line\"><span class=\"comment\">#混淆前后的映射</span></span><br><span class=\"line\">-printmapping proguard/mapping.txt</span><br><span class=\"line\"><span class=\"comment\">#-------------End：记录生成的日志数据,gradle build时在本项目根目录输出-------------#</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#避免混淆泛型 如果混淆报错建议关掉</span></span><br><span class=\"line\"><span class=\"comment\">#-keepattributes Signature</span></span><br><span class=\"line\"><span class=\"comment\">#保护注解</span></span><br><span class=\"line\">-keepattributes *Annotation*</span><br><span class=\"line\"><span class=\"comment\"># 保持哪些类不被混淆</span></span><br><span class=\"line\">-keep public class * extends android.support.v4.app.Fragment</span><br><span class=\"line\">-keep public class * extends android.app.Activity</span><br><span class=\"line\">-keep public class * extends android.app.Application</span><br><span class=\"line\">-keep public class * extends android.app.Service</span><br><span class=\"line\">-keep public class * extends android.content.BroadcastReceiver</span><br><span class=\"line\">-keep public class * extends android.content.ContentProvider</span><br><span class=\"line\">-keep public class * extends android.app.backup.BackupAgentHelper</span><br><span class=\"line\">-keep public class * extends android.preference.Preference</span><br><span class=\"line\">-keep public class com.android.vending.licensing.ILicensingService</span><br><span class=\"line\">-dontnote com.android.vending.licensing.ILicensingService</span><br><span class=\"line\"><span class=\"comment\">#如果有引用v4包可以添加下面这行</span></span><br><span class=\"line\"><span class=\"comment\">#-keep public class * extends android.support.v4.app.Fragment</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#忽略警告</span></span><br><span class=\"line\">-ignorewarning</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#如果引用了v4或者v7包</span></span><br><span class=\"line\">-dontwarn android.support.**</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持 native 方法不被混淆</span></span><br><span class=\"line\">-keepclasseswithmembernames class * &#123;</span><br><span class=\"line\">    native &lt;methods&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持自定义控件类不被混淆</span></span><br><span class=\"line\">-keepclasseswithmembers class * &#123;</span><br><span class=\"line\">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keepclasseswithmembers  class * &#123;</span><br><span class=\"line\">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keep public class * extends android.view.View &#123;</span><br><span class=\"line\">    public &lt;init&gt;(android.content.Context);</span><br><span class=\"line\">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet);</span><br><span class=\"line\">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);</span><br><span class=\"line\">    public void <span class=\"built_in\">set</span>*(...);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持 Parcelable 不被混淆</span></span><br><span class=\"line\">-keep class * implements android.os.Parcelable &#123;</span><br><span class=\"line\">  public static final android.os.Parcelable<span class=\"variable\">$Creator</span> *;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持 Serializable 不被混淆</span></span><br><span class=\"line\">-keepnames class * implements java.io.Serializable</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持 Serializable 不被混淆并且enum 类也不被混淆</span></span><br><span class=\"line\">-keepclassmembers class * implements java.io.Serializable &#123;</span><br><span class=\"line\">    static final long serialVersionUID;</span><br><span class=\"line\">    private static final java.io.ObjectStreamField[] serialPersistentFields;</span><br><span class=\"line\">    !static !transient &lt;fields&gt;;</span><br><span class=\"line\">    !private &lt;fields&gt;;</span><br><span class=\"line\">    !private &lt;methods&gt;;</span><br><span class=\"line\">    private void writeObject(java.io.ObjectOutputStream);</span><br><span class=\"line\">    private void readObject(java.io.ObjectInputStream);</span><br><span class=\"line\">    java.lang.Object writeReplace();</span><br><span class=\"line\">    java.lang.Object readResolve();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持枚举 enum 类不被混淆</span></span><br><span class=\"line\">-keepclassmembers enum * &#123;</span><br><span class=\"line\">    public static **[] values();</span><br><span class=\"line\">    public static ** valueOf(java.lang.String);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keepclassmembers class * &#123;</span><br><span class=\"line\">    public void *ButtonClicked(android.view.View);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#不混淆资源类</span></span><br><span class=\"line\">-keepclassmembers class **.R$* &#123;</span><br><span class=\"line\">    public static &lt;fields&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-keep class **.R &#123; *; &#125;</span><br><span class=\"line\">-keep class **.R$* &#123; *; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#移除Log类打印各个等级日志的代码，打正式包的时候可以做为禁log使用，这里可以作为禁止log打印的功能使用，另外的一种实现方案是通过BuildConfig.DEBUG的变量来控制</span></span><br><span class=\"line\"><span class=\"comment\">#-assumenosideeffects class android.util.Log &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#    public static *** v(...);</span></span><br><span class=\"line\"><span class=\"comment\">#    public static *** i(...);</span></span><br><span class=\"line\"><span class=\"comment\">#    public static *** d(...);</span></span><br><span class=\"line\"><span class=\"comment\">#    public static *** w(...);</span></span><br><span class=\"line\"><span class=\"comment\">#    public static *** e(...);</span></span><br><span class=\"line\"><span class=\"comment\">#&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">-keepclassmembers class * &#123;</span><br><span class=\"line\">    @android.webkit.JavascriptInterface &lt;methods&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keep class * extends java.util.ListResourceBundle &#123;</span><br><span class=\"line\">    protected Object[][] getContents();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>ReactNative混淆配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#------------------------Start: React Native------------------------#</span></span><br><span class=\"line\"><span class=\"comment\"># Keep our interfaces so they can be used by other ProGuard rules.</span></span><br><span class=\"line\"><span class=\"comment\"># See http://sourceforge.net/p/proguard/bugs/466/</span></span><br><span class=\"line\">-keep,allowobfuscation @interface com.facebook.proguard.annotations.DoNotStrip</span><br><span class=\"line\">-keep,allowobfuscation @interface com.facebook.proguard.annotations.KeepGettersAndSetters</span><br><span class=\"line\">-keep,allowobfuscation @interface com.facebook.common.internal.DoNotStrip</span><br><span class=\"line\"><span class=\"comment\"># Do not strip any method/class that is annotated with @DoNotStrip</span></span><br><span class=\"line\">-keep @com.facebook.proguard.annotations.DoNotStrip class *</span><br><span class=\"line\">-keep @com.facebook.common.internal.DoNotStrip class *</span><br><span class=\"line\">-keepclassmembers class * &#123;</span><br><span class=\"line\">    @com.facebook.proguard.annotations.DoNotStrip *;</span><br><span class=\"line\">    @com.facebook.common.internal.DoNotStrip *;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-keepclassmembers @com.facebook.proguard.annotations.KeepGettersAndSetters class * &#123;</span><br><span class=\"line\">    void <span class=\"built_in\">set</span>*(***);</span><br><span class=\"line\">    *** get*();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keep class com.facebook.react.cxxbridge.ModuleRegistryHolder &#123; *; &#125;</span><br><span class=\"line\">-keep class com.facebook.react.cxxbridge.CatalystInstanceImpl &#123; *; &#125;</span><br><span class=\"line\">-keep class com.facebook.react.cxxbridge.JavaScriptExecutor &#123; *; &#125;</span><br><span class=\"line\">-keep class com.facebook.react.bridge.queue.NativeRunnable &#123; *; &#125;</span><br><span class=\"line\">-keep class com.facebook.react.bridge.ExecutorToken &#123; *; &#125;</span><br><span class=\"line\">-keep class com.facebook.react.bridge.ReadableType &#123; *; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keep class * extends com.facebook.react.bridge.JavaScriptModule &#123; *; &#125;</span><br><span class=\"line\">-keep class * extends com.facebook.react.bridge.NativeModule &#123; *; &#125;</span><br><span class=\"line\">-keepclassmembers,includedescriptorclasses class * &#123; native &lt;methods&gt;; &#125;</span><br><span class=\"line\">-keepclassmembers class *  &#123; @com.facebook.react.uimanager.UIProp &lt;fields&gt;; &#125;</span><br><span class=\"line\">-keepclassmembers class *  &#123; @com.facebook.react.uimanager.annotations.ReactProp &lt;methods&gt;; &#125;</span><br><span class=\"line\">-keepclassmembers class *  &#123; @com.facebook.react.uimanager.annotations.ReactPropGroup &lt;methods&gt;; &#125;</span><br><span class=\"line\">-dontwarn com.facebook.react.**</span><br><span class=\"line\"><span class=\"comment\"># stetho</span></span><br><span class=\"line\">-dontwarn com.facebook.stetho.**</span><br><span class=\"line\"></span><br><span class=\"line\">-keep class android.text.StaticLayout</span><br><span class=\"line\"><span class=\"comment\">#------------------------End: React Native------------------------#</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Gson</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keepattributes Signature</span><br><span class=\"line\">-keepattributes *Annotation*</span><br><span class=\"line\">-keep class sun.misc.Unsafe &#123; *; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Application classes that will be serialized/deserialized over Gson</span></span><br><span class=\"line\"><span class=\"comment\"># 下面替换成自己的实体类</span></span><br><span class=\"line\">-keep class com.example.bean.** &#123; *; &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Butter Knife</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keep class butterknife.** &#123; *; &#125;</span><br><span class=\"line\">-dontwarn butterknife.internal.**</span><br><span class=\"line\">-keep class **$<span class=\"variable\">$ViewBinder</span> &#123; *; &#125;</span><br><span class=\"line\">-keepclasseswithmembernames class * &#123;</span><br><span class=\"line\">    @butterknife.* &lt;fields&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-keepclasseswithmembernames class * &#123;</span><br><span class=\"line\">    @butterknife.* &lt;methods&gt;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Okio</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-dontwarn com.squareup.**  </span><br><span class=\"line\">-dontwarn okio.**  </span><br><span class=\"line\">-keep public class org.codehaus.* &#123; *; &#125;  </span><br><span class=\"line\">-keep public class java.nio.* &#123; *; &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>OkHttp3</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-dontwarn com.squareup.okhttp3.**</span><br><span class=\"line\">-keep class com.squareup.okhttp3.** &#123; *;&#125;</span><br><span class=\"line\">-dontwarn okio.**</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Retrofit</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-dontwarn retrofit2.**</span><br><span class=\"line\">-keep class retrofit2.** &#123; *; &#125;</span><br><span class=\"line\">-keepattributes Signature</span><br><span class=\"line\">-keepattributes Exceptions</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Ormlite</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keepattributes *DatabaseField*  </span><br><span class=\"line\">-keepattributes *DatabaseTable*  </span><br><span class=\"line\">-keepattributes *SerializedName*  </span><br><span class=\"line\">-keep class com.j256.**  </span><br><span class=\"line\">-keepclassmembers class com.j256.** &#123; *; &#125;  </span><br><span class=\"line\">-keep enum com.j256.**  </span><br><span class=\"line\">-keepclassmembers enum com.j256.** &#123; *; &#125;  </span><br><span class=\"line\">-keep interface com.j256.**  </span><br><span class=\"line\">-keepclassmembers interface com.j256.** &#123; *; &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>RxJava RxAndroid</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-dontwarn sun.misc.**  </span><br><span class=\"line\">-keepclassmembers class rx.internal.util.unsafe.*ArrayQueue*Field* &#123;  </span><br><span class=\"line\">  long producerIndex;  </span><br><span class=\"line\">  long consumerIndex;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">-keepclassmembers class rx.internal.util.unsafe.BaseLinkedQueueProducerNodeRef &#123;  </span><br><span class=\"line\">  rx.internal.util.atomic.LinkedQueueNode producerNode;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">-keepclassmembers class rx.internal.util.unsafe.BaseLinkedQueueConsumerNodeRef &#123;  </span><br><span class=\"line\">  rx.internal.util.atomic.LinkedQueueNode consumerNode;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>AndroidEventBus</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keep class org.simple.** &#123; *; &#125;</span><br><span class=\"line\">-keep interface org.simple.** &#123; *; &#125;</span><br><span class=\"line\">-keepclassmembers class * &#123;</span><br><span class=\"line\">    @org.simple.eventbus.Subscriber &lt;methods&gt;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>EventBus</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keepattributes *Annotation*</span><br><span class=\"line\">-keepclassmembers class ** &#123;</span><br><span class=\"line\">    @org.greenrobot.eventbus.Subscribe &lt;methods&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-keep enum org.greenrobot.eventbus.ThreadMode &#123; *; &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Glide</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keep public class * implements com.bumptech.glide.module.GlideModule</span><br><span class=\"line\">-keep public enum com.bumptech.glide.load.resource.bitmap.ImageHeaderParser$** &#123;</span><br><span class=\"line\">  **[] <span class=\"variable\">$VALUES</span>;</span><br><span class=\"line\">  public *;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"混淆语法解析\"><a class=\"header-anchor\" href=\"#混淆语法解析\"></a>混淆语法解析</h2>\n<ul>\n<li>\n<p>保留选项（配置不进行处理的内容）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 保护指定的类文件和类的成员</span></span><br><span class=\"line\">-keep &#123;modifier&#125; &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 保护指定类的成员，如果此类受到保护他们会保护的更好</span></span><br><span class=\"line\">-keepclassmembers &#123;modifier&#125; &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 保护指定的类和类的成员，但条件是所有指定的类和类成员是要存在。</span></span><br><span class=\"line\">-keepclasseswithmembers &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 保护指定的类和类的成员的名称（如果他们不会压缩步骤中删除）</span></span><br><span class=\"line\">-keepnames &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 保护指定的类的成员的名称（如果他们不会压缩步骤中删除）</span></span><br><span class=\"line\">-keepclassmembernames &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 保护指定的类和类的成员的名称，如果所有指定的类成员出席（在压缩步骤之后）</span></span><br><span class=\"line\">-keepclasseswithmembernames &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 列出类和类的成员-keep选项的清单，标准输出到给定的文件</span></span><br><span class=\"line\">-printseeds &#123;filename&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>压缩</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 不压缩输入的类文件</span></span><br><span class=\"line\">-dontshrink</span><br><span class=\"line\"><span class=\"comment\"># 打印为什么一个类或类的成员被保护,这对检查一个输出文件中的类的结果有帮助.</span></span><br><span class=\"line\">-whyareyoukeeping &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 将被删除的元素输出到文件</span></span><br><span class=\"line\">-printusage &#123;filename&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>优化</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 不优化输入的类文件</span></span><br><span class=\"line\">-dontoptimize</span><br><span class=\"line\"><span class=\"comment\"># 优化时假设指定的方法，没有任何副作用</span></span><br><span class=\"line\">-assumenosideeffects &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 优化时允许访问并修改有修饰符的类和类的成员</span></span><br><span class=\"line\">-allowaccessmodification</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>混淆</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 不混淆输入的类文件</span></span><br><span class=\"line\">-dontobfuscate</span><br><span class=\"line\"><span class=\"comment\"># 使用给定文件中的关键字作为要混淆方法的名称</span></span><br><span class=\"line\">-obfuscationdictionary &#123;filename&#125;</span><br><span class=\"line\"><span class=\"comment\"># 混淆时应用侵入式重载</span></span><br><span class=\"line\">-overloadaggressively</span><br><span class=\"line\"><span class=\"comment\"># 确定统一的混淆类的成员名称来增加混淆</span></span><br><span class=\"line\">-useuniqueclassmembernames</span><br><span class=\"line\"><span class=\"comment\"># 重新包装所有重命名的包并放在给定的单一包中</span></span><br><span class=\"line\">-flattenpackagehierarchy &#123;package_name&#125;</span><br><span class=\"line\"><span class=\"comment\"># 重新包装所有重命名的类文件中放在给定的单一包中</span></span><br><span class=\"line\">-repackageclass &#123;package_name&#125;</span><br><span class=\"line\"><span class=\"comment\"># 混淆时不会产生形形色色的类名</span></span><br><span class=\"line\">-dontusemixedcaseclassnames</span><br><span class=\"line\"><span class=\"comment\"># 保护给定的可选属性，例如LineNumberTable, LocalVariableTable, SourceFile, Deprecated, Synthetic, Signature, and InnerClasses.</span></span><br><span class=\"line\">-keepattributes &#123;attribute_name,...&#125;</span><br><span class=\"line\"><span class=\"comment\"># 设置源文件中给定的字符串常量</span></span><br><span class=\"line\">-renamesourcefileattribute &#123;string&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n","more":"<h2 id=\"作用\"><a class=\"header-anchor\" href=\"#作用\"></a>作用</h2>\n<blockquote>\n<p>          代码混淆由ProGuard提供支持，ProGuard会检测和移除封装应用中未使用的类、字段、方法和属性，包括自带代码库中的未使用项（这使其成为以变通方式解决64k引用限制的有用工具）。ProGuard还可优化字节码，移除未使用的代码指令，以及用短名称混淆其余的类、字段和方法。混淆过的代码可令您的APK难以被逆向工程，这在应用使用许可验证等安全敏感性功能时特别有用。</p>\n</blockquote>\n<p>以上为Android官网<a href=\"https://developer.android.com/studio/build/shrink-code.html\" target=\"_blank\" rel=\"noopener\">原文</a>描述，其主要作用主要有那么几点：</p>\n<ul>\n<li>减少方法数</li>\n<li>增加反编译的难度</li>\n<li>app瘦身</li>\n</ul>\n<h2 id=\"一言不合上实例\"><a class=\"header-anchor\" href=\"#一言不合上实例\"></a>一言不合上实例</h2>\n<p>以下为收集整理的混淆配置，复制到项目就可使用</p>\n<ul>\n<li>\n<p>通用配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#开启即可关闭混淆</span></span><br><span class=\"line\"><span class=\"comment\">#-dontobfuscate</span></span><br><span class=\"line\"><span class=\"comment\">#---------------Begin: proguard configuration common for all Android apps ----------#</span></span><br><span class=\"line\"><span class=\"comment\">#指定代码的压缩级别</span></span><br><span class=\"line\">-optimizationpasses 5</span><br><span class=\"line\"><span class=\"comment\">#包名不混合大小写</span></span><br><span class=\"line\">-dontusemixedcaseclassnames</span><br><span class=\"line\"><span class=\"comment\">#不去忽略非公共的库类</span></span><br><span class=\"line\">-dontskipnonpubliclibraryclasses</span><br><span class=\"line\">-dontskipnonpubliclibraryclassmembers</span><br><span class=\"line\"><span class=\"comment\">#优化  不优化输入的类文件</span></span><br><span class=\"line\">-dontoptimize</span><br><span class=\"line\"><span class=\"comment\">#预校验</span></span><br><span class=\"line\">-dontpreverify</span><br><span class=\"line\"><span class=\"comment\">#混淆时是否记录日志</span></span><br><span class=\"line\">-verbose</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 混淆时所采用的算法</span></span><br><span class=\"line\">-optimizations !code/simplification/arithmetic,!field/*,!class/merging/*</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#-------------start：记录生成的日志数据,gradle build时在本项目根目录输出-------------#</span></span><br><span class=\"line\"><span class=\"comment\">#apk 包内所有 class 的内部结构</span></span><br><span class=\"line\">-dump proguard/class_files.txt</span><br><span class=\"line\"><span class=\"comment\">#未混淆的类和成员</span></span><br><span class=\"line\">-printseeds proguard/seeds.txt</span><br><span class=\"line\"><span class=\"comment\">#列出从 apk 中删除的代码</span></span><br><span class=\"line\">-printusage proguard/unused.txt</span><br><span class=\"line\"><span class=\"comment\">#混淆前后的映射</span></span><br><span class=\"line\">-printmapping proguard/mapping.txt</span><br><span class=\"line\"><span class=\"comment\">#-------------End：记录生成的日志数据,gradle build时在本项目根目录输出-------------#</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#避免混淆泛型 如果混淆报错建议关掉</span></span><br><span class=\"line\"><span class=\"comment\">#-keepattributes Signature</span></span><br><span class=\"line\"><span class=\"comment\">#保护注解</span></span><br><span class=\"line\">-keepattributes *Annotation*</span><br><span class=\"line\"><span class=\"comment\"># 保持哪些类不被混淆</span></span><br><span class=\"line\">-keep public class * extends android.support.v4.app.Fragment</span><br><span class=\"line\">-keep public class * extends android.app.Activity</span><br><span class=\"line\">-keep public class * extends android.app.Application</span><br><span class=\"line\">-keep public class * extends android.app.Service</span><br><span class=\"line\">-keep public class * extends android.content.BroadcastReceiver</span><br><span class=\"line\">-keep public class * extends android.content.ContentProvider</span><br><span class=\"line\">-keep public class * extends android.app.backup.BackupAgentHelper</span><br><span class=\"line\">-keep public class * extends android.preference.Preference</span><br><span class=\"line\">-keep public class com.android.vending.licensing.ILicensingService</span><br><span class=\"line\">-dontnote com.android.vending.licensing.ILicensingService</span><br><span class=\"line\"><span class=\"comment\">#如果有引用v4包可以添加下面这行</span></span><br><span class=\"line\"><span class=\"comment\">#-keep public class * extends android.support.v4.app.Fragment</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#忽略警告</span></span><br><span class=\"line\">-ignorewarning</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#如果引用了v4或者v7包</span></span><br><span class=\"line\">-dontwarn android.support.**</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持 native 方法不被混淆</span></span><br><span class=\"line\">-keepclasseswithmembernames class * &#123;</span><br><span class=\"line\">    native &lt;methods&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持自定义控件类不被混淆</span></span><br><span class=\"line\">-keepclasseswithmembers class * &#123;</span><br><span class=\"line\">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keepclasseswithmembers  class * &#123;</span><br><span class=\"line\">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keep public class * extends android.view.View &#123;</span><br><span class=\"line\">    public &lt;init&gt;(android.content.Context);</span><br><span class=\"line\">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet);</span><br><span class=\"line\">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);</span><br><span class=\"line\">    public void <span class=\"built_in\">set</span>*(...);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持 Parcelable 不被混淆</span></span><br><span class=\"line\">-keep class * implements android.os.Parcelable &#123;</span><br><span class=\"line\">  public static final android.os.Parcelable<span class=\"variable\">$Creator</span> *;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持 Serializable 不被混淆</span></span><br><span class=\"line\">-keepnames class * implements java.io.Serializable</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持 Serializable 不被混淆并且enum 类也不被混淆</span></span><br><span class=\"line\">-keepclassmembers class * implements java.io.Serializable &#123;</span><br><span class=\"line\">    static final long serialVersionUID;</span><br><span class=\"line\">    private static final java.io.ObjectStreamField[] serialPersistentFields;</span><br><span class=\"line\">    !static !transient &lt;fields&gt;;</span><br><span class=\"line\">    !private &lt;fields&gt;;</span><br><span class=\"line\">    !private &lt;methods&gt;;</span><br><span class=\"line\">    private void writeObject(java.io.ObjectOutputStream);</span><br><span class=\"line\">    private void readObject(java.io.ObjectInputStream);</span><br><span class=\"line\">    java.lang.Object writeReplace();</span><br><span class=\"line\">    java.lang.Object readResolve();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保持枚举 enum 类不被混淆</span></span><br><span class=\"line\">-keepclassmembers enum * &#123;</span><br><span class=\"line\">    public static **[] values();</span><br><span class=\"line\">    public static ** valueOf(java.lang.String);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keepclassmembers class * &#123;</span><br><span class=\"line\">    public void *ButtonClicked(android.view.View);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#不混淆资源类</span></span><br><span class=\"line\">-keepclassmembers class **.R$* &#123;</span><br><span class=\"line\">    public static &lt;fields&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-keep class **.R &#123; *; &#125;</span><br><span class=\"line\">-keep class **.R$* &#123; *; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#移除Log类打印各个等级日志的代码，打正式包的时候可以做为禁log使用，这里可以作为禁止log打印的功能使用，另外的一种实现方案是通过BuildConfig.DEBUG的变量来控制</span></span><br><span class=\"line\"><span class=\"comment\">#-assumenosideeffects class android.util.Log &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#    public static *** v(...);</span></span><br><span class=\"line\"><span class=\"comment\">#    public static *** i(...);</span></span><br><span class=\"line\"><span class=\"comment\">#    public static *** d(...);</span></span><br><span class=\"line\"><span class=\"comment\">#    public static *** w(...);</span></span><br><span class=\"line\"><span class=\"comment\">#    public static *** e(...);</span></span><br><span class=\"line\"><span class=\"comment\">#&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">-keepclassmembers class * &#123;</span><br><span class=\"line\">    @android.webkit.JavascriptInterface &lt;methods&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keep class * extends java.util.ListResourceBundle &#123;</span><br><span class=\"line\">    protected Object[][] getContents();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>ReactNative混淆配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#------------------------Start: React Native------------------------#</span></span><br><span class=\"line\"><span class=\"comment\"># Keep our interfaces so they can be used by other ProGuard rules.</span></span><br><span class=\"line\"><span class=\"comment\"># See http://sourceforge.net/p/proguard/bugs/466/</span></span><br><span class=\"line\">-keep,allowobfuscation @interface com.facebook.proguard.annotations.DoNotStrip</span><br><span class=\"line\">-keep,allowobfuscation @interface com.facebook.proguard.annotations.KeepGettersAndSetters</span><br><span class=\"line\">-keep,allowobfuscation @interface com.facebook.common.internal.DoNotStrip</span><br><span class=\"line\"><span class=\"comment\"># Do not strip any method/class that is annotated with @DoNotStrip</span></span><br><span class=\"line\">-keep @com.facebook.proguard.annotations.DoNotStrip class *</span><br><span class=\"line\">-keep @com.facebook.common.internal.DoNotStrip class *</span><br><span class=\"line\">-keepclassmembers class * &#123;</span><br><span class=\"line\">    @com.facebook.proguard.annotations.DoNotStrip *;</span><br><span class=\"line\">    @com.facebook.common.internal.DoNotStrip *;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-keepclassmembers @com.facebook.proguard.annotations.KeepGettersAndSetters class * &#123;</span><br><span class=\"line\">    void <span class=\"built_in\">set</span>*(***);</span><br><span class=\"line\">    *** get*();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keep class com.facebook.react.cxxbridge.ModuleRegistryHolder &#123; *; &#125;</span><br><span class=\"line\">-keep class com.facebook.react.cxxbridge.CatalystInstanceImpl &#123; *; &#125;</span><br><span class=\"line\">-keep class com.facebook.react.cxxbridge.JavaScriptExecutor &#123; *; &#125;</span><br><span class=\"line\">-keep class com.facebook.react.bridge.queue.NativeRunnable &#123; *; &#125;</span><br><span class=\"line\">-keep class com.facebook.react.bridge.ExecutorToken &#123; *; &#125;</span><br><span class=\"line\">-keep class com.facebook.react.bridge.ReadableType &#123; *; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-keep class * extends com.facebook.react.bridge.JavaScriptModule &#123; *; &#125;</span><br><span class=\"line\">-keep class * extends com.facebook.react.bridge.NativeModule &#123; *; &#125;</span><br><span class=\"line\">-keepclassmembers,includedescriptorclasses class * &#123; native &lt;methods&gt;; &#125;</span><br><span class=\"line\">-keepclassmembers class *  &#123; @com.facebook.react.uimanager.UIProp &lt;fields&gt;; &#125;</span><br><span class=\"line\">-keepclassmembers class *  &#123; @com.facebook.react.uimanager.annotations.ReactProp &lt;methods&gt;; &#125;</span><br><span class=\"line\">-keepclassmembers class *  &#123; @com.facebook.react.uimanager.annotations.ReactPropGroup &lt;methods&gt;; &#125;</span><br><span class=\"line\">-dontwarn com.facebook.react.**</span><br><span class=\"line\"><span class=\"comment\"># stetho</span></span><br><span class=\"line\">-dontwarn com.facebook.stetho.**</span><br><span class=\"line\"></span><br><span class=\"line\">-keep class android.text.StaticLayout</span><br><span class=\"line\"><span class=\"comment\">#------------------------End: React Native------------------------#</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Gson</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keepattributes Signature</span><br><span class=\"line\">-keepattributes *Annotation*</span><br><span class=\"line\">-keep class sun.misc.Unsafe &#123; *; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Application classes that will be serialized/deserialized over Gson</span></span><br><span class=\"line\"><span class=\"comment\"># 下面替换成自己的实体类</span></span><br><span class=\"line\">-keep class com.example.bean.** &#123; *; &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Butter Knife</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keep class butterknife.** &#123; *; &#125;</span><br><span class=\"line\">-dontwarn butterknife.internal.**</span><br><span class=\"line\">-keep class **$<span class=\"variable\">$ViewBinder</span> &#123; *; &#125;</span><br><span class=\"line\">-keepclasseswithmembernames class * &#123;</span><br><span class=\"line\">    @butterknife.* &lt;fields&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-keepclasseswithmembernames class * &#123;</span><br><span class=\"line\">    @butterknife.* &lt;methods&gt;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Okio</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-dontwarn com.squareup.**  </span><br><span class=\"line\">-dontwarn okio.**  </span><br><span class=\"line\">-keep public class org.codehaus.* &#123; *; &#125;  </span><br><span class=\"line\">-keep public class java.nio.* &#123; *; &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>OkHttp3</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-dontwarn com.squareup.okhttp3.**</span><br><span class=\"line\">-keep class com.squareup.okhttp3.** &#123; *;&#125;</span><br><span class=\"line\">-dontwarn okio.**</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Retrofit</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-dontwarn retrofit2.**</span><br><span class=\"line\">-keep class retrofit2.** &#123; *; &#125;</span><br><span class=\"line\">-keepattributes Signature</span><br><span class=\"line\">-keepattributes Exceptions</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Ormlite</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keepattributes *DatabaseField*  </span><br><span class=\"line\">-keepattributes *DatabaseTable*  </span><br><span class=\"line\">-keepattributes *SerializedName*  </span><br><span class=\"line\">-keep class com.j256.**  </span><br><span class=\"line\">-keepclassmembers class com.j256.** &#123; *; &#125;  </span><br><span class=\"line\">-keep enum com.j256.**  </span><br><span class=\"line\">-keepclassmembers enum com.j256.** &#123; *; &#125;  </span><br><span class=\"line\">-keep interface com.j256.**  </span><br><span class=\"line\">-keepclassmembers interface com.j256.** &#123; *; &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>RxJava RxAndroid</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-dontwarn sun.misc.**  </span><br><span class=\"line\">-keepclassmembers class rx.internal.util.unsafe.*ArrayQueue*Field* &#123;  </span><br><span class=\"line\">  long producerIndex;  </span><br><span class=\"line\">  long consumerIndex;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">-keepclassmembers class rx.internal.util.unsafe.BaseLinkedQueueProducerNodeRef &#123;  </span><br><span class=\"line\">  rx.internal.util.atomic.LinkedQueueNode producerNode;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">-keepclassmembers class rx.internal.util.unsafe.BaseLinkedQueueConsumerNodeRef &#123;  </span><br><span class=\"line\">  rx.internal.util.atomic.LinkedQueueNode consumerNode;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>AndroidEventBus</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keep class org.simple.** &#123; *; &#125;</span><br><span class=\"line\">-keep interface org.simple.** &#123; *; &#125;</span><br><span class=\"line\">-keepclassmembers class * &#123;</span><br><span class=\"line\">    @org.simple.eventbus.Subscriber &lt;methods&gt;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>EventBus</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keepattributes *Annotation*</span><br><span class=\"line\">-keepclassmembers class ** &#123;</span><br><span class=\"line\">    @org.greenrobot.eventbus.Subscribe &lt;methods&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-keep enum org.greenrobot.eventbus.ThreadMode &#123; *; &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>Glide</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-keep public class * implements com.bumptech.glide.module.GlideModule</span><br><span class=\"line\">-keep public enum com.bumptech.glide.load.resource.bitmap.ImageHeaderParser$** &#123;</span><br><span class=\"line\">  **[] <span class=\"variable\">$VALUES</span>;</span><br><span class=\"line\">  public *;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"混淆语法解析\"><a class=\"header-anchor\" href=\"#混淆语法解析\"></a>混淆语法解析</h2>\n<ul>\n<li>\n<p>保留选项（配置不进行处理的内容）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 保护指定的类文件和类的成员</span></span><br><span class=\"line\">-keep &#123;modifier&#125; &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 保护指定类的成员，如果此类受到保护他们会保护的更好</span></span><br><span class=\"line\">-keepclassmembers &#123;modifier&#125; &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 保护指定的类和类的成员，但条件是所有指定的类和类成员是要存在。</span></span><br><span class=\"line\">-keepclasseswithmembers &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 保护指定的类和类的成员的名称（如果他们不会压缩步骤中删除）</span></span><br><span class=\"line\">-keepnames &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 保护指定的类的成员的名称（如果他们不会压缩步骤中删除）</span></span><br><span class=\"line\">-keepclassmembernames &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 保护指定的类和类的成员的名称，如果所有指定的类成员出席（在压缩步骤之后）</span></span><br><span class=\"line\">-keepclasseswithmembernames &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 列出类和类的成员-keep选项的清单，标准输出到给定的文件</span></span><br><span class=\"line\">-printseeds &#123;filename&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>压缩</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 不压缩输入的类文件</span></span><br><span class=\"line\">-dontshrink</span><br><span class=\"line\"><span class=\"comment\"># 打印为什么一个类或类的成员被保护,这对检查一个输出文件中的类的结果有帮助.</span></span><br><span class=\"line\">-whyareyoukeeping &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 将被删除的元素输出到文件</span></span><br><span class=\"line\">-printusage &#123;filename&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>优化</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 不优化输入的类文件</span></span><br><span class=\"line\">-dontoptimize</span><br><span class=\"line\"><span class=\"comment\"># 优化时假设指定的方法，没有任何副作用</span></span><br><span class=\"line\">-assumenosideeffects &#123;class_specification&#125;</span><br><span class=\"line\"><span class=\"comment\"># 优化时允许访问并修改有修饰符的类和类的成员</span></span><br><span class=\"line\">-allowaccessmodification</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>混淆</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 不混淆输入的类文件</span></span><br><span class=\"line\">-dontobfuscate</span><br><span class=\"line\"><span class=\"comment\"># 使用给定文件中的关键字作为要混淆方法的名称</span></span><br><span class=\"line\">-obfuscationdictionary &#123;filename&#125;</span><br><span class=\"line\"><span class=\"comment\"># 混淆时应用侵入式重载</span></span><br><span class=\"line\">-overloadaggressively</span><br><span class=\"line\"><span class=\"comment\"># 确定统一的混淆类的成员名称来增加混淆</span></span><br><span class=\"line\">-useuniqueclassmembernames</span><br><span class=\"line\"><span class=\"comment\"># 重新包装所有重命名的包并放在给定的单一包中</span></span><br><span class=\"line\">-flattenpackagehierarchy &#123;package_name&#125;</span><br><span class=\"line\"><span class=\"comment\"># 重新包装所有重命名的类文件中放在给定的单一包中</span></span><br><span class=\"line\">-repackageclass &#123;package_name&#125;</span><br><span class=\"line\"><span class=\"comment\"># 混淆时不会产生形形色色的类名</span></span><br><span class=\"line\">-dontusemixedcaseclassnames</span><br><span class=\"line\"><span class=\"comment\"># 保护给定的可选属性，例如LineNumberTable, LocalVariableTable, SourceFile, Deprecated, Synthetic, Signature, and InnerClasses.</span></span><br><span class=\"line\">-keepattributes &#123;attribute_name,...&#125;</span><br><span class=\"line\"><span class=\"comment\"># 设置源文件中给定的字符串常量</span></span><br><span class=\"line\">-renamesourcefileattribute &#123;string&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>","categories":[],"tags":[{"name":"android","path":"api/tags/android.json"}]}